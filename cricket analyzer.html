<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricket Match Similarity</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: auto; }
        input, button { margin: 10px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
    </style>
    <!-- XLSX.js library for reading Excel files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Cricket Match Similarity</h1>
        <form id="matchForm">
            <label for="excelFile">Upload Excel File:</label>
            <input type="file" id="excelFile" name="excelFile" accept=".xlsx" required><br>

            <label for="scores">Enter Ongoing Match Scores (1-20 overs):</label>
            <input type="text" id="scores" name="scores" placeholder="e.g., 45/2, 78/3, ..." required><br>

            <button type="submit">Submit</button>
        </form>

        <h2>Euclidean Distance Results</h2>
        <table id="euclideanResults">
            <thead>
                <tr>
                    <th>6 Overs</th>
                    <th>10 Overs</th>
                    <th>15 Overs</th>
                    <th>20 Overs</th>
                    <th>Result</th>
                    <th>26 Overs</th>
                    <th>30 Overs</th>
                    <th>35 Overs</th>
                    <th>40 Overs</th>
                </tr>
            </thead>
            <tbody>
                <!-- Results will be populated here -->
            </tbody>
        </table>

        <h2>Cosine Similarity Results</h2>
        <table id="cosineResults">
            <thead>
                <tr>
                    <th>6 Overs</th>
                    <th>10 Overs</th>
                    <th>15 Overs</th>
                    <th>20 Overs</th>
                    <th>Result</th>
                    <th>26 Overs</th>
                    <th>30 Overs</th>
                    <th>35 Overs</th>
                    <th>40 Overs</th>
                </tr>
            </thead>
            <tbody>
                <!-- Results will be populated here -->
            </tbody>
        </table>
    </div>

    <script>
        // Function to calculate Euclidean Distance
        function euclideanDistance(a, b) {
            let sum = 0;
            for (let i = 0; i < a.length; i++) {
                sum += Math.pow(a[i] - b[i], 2);
            }
            return Math.sqrt(sum);
        }

        // Function to calculate Cosine Similarity
        function cosineSimilarity(a, b) {
            let dotProduct = 0;
            let magnitudeA = 0;
            let magnitudeB = 0;
            for (let i = 0; i < a.length; i++) {
                dotProduct += a[i] * b[i];
                magnitudeA += Math.pow(a[i], 2);
                magnitudeB += Math.pow(b[i], 2);
            }
            magnitudeA = Math.sqrt(magnitudeA);
            magnitudeB = Math.sqrt(magnitudeB);
            return dotProduct / (magnitudeA * magnitudeB);
        }

        // Function to process the Excel file
        function processExcel(file, scores) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const sheet = workbook.Sheets[sheetName];
                const jsonData = XLSX.utils.sheet_to_json(sheet);

                // Calculate Euclidean Distance and Cosine Similarity
                const euclideanResults = [];
                const cosineResults = [];

                jsonData.forEach(row => {
                    const matchScores = [];
                    for (let i = 1; i <= 20; i++) {
                        const score = row[`${i}over`].split('/');
                        matchScores.push(parseInt(score[0])); // Use only runs for similarity
                    }

                    const euclideanDist = euclideanDistance(scores, matchScores);
                    const cosineSim = cosineSimilarity(scores, matchScores);

                    euclideanResults.push({ distance: euclideanDist, row });
                    cosineResults.push({ similarity: cosineSim, row });
                });

                // Sort and get top 10 results
                euclideanResults.sort((a, b) => a.distance - b.distance);
                cosineResults.sort((a, b) => b.similarity - a.similarity);

                const topEuclidean = euclideanResults.slice(0, 10);
                const topCosine = cosineResults.slice(0, 10);

                // Display results
                displayResults('euclideanResults', topEuclidean);
                displayResults('cosineResults', topCosine);
            };
            reader.readAsArrayBuffer(file);
        }

        // Function to display results in the table
        function displayResults(tableId, results) {
            const table = document.getElementById(tableId).getElementsByTagName('tbody')[0];
            table.innerHTML = '';
            results.forEach(result => {
                const row = table.insertRow();
                const rowData = result.row;
                const columns = ['6over', '10over', '15over', '20over', 'result', '26over', '30over', '35over', '40over'];
                columns.forEach(col => {
                    const cell = row.insertCell();
                    cell.textContent = rowData[col];
                });
            });
        }

        // Handle form submission
        document.getElementById('matchForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const file = document.getElementById('excelFile').files[0];
            const scores = document.getElementById('scores').value.split(',').map(s => parseInt(s.trim().split('/')[0]));

            if (file && scores.length === 20) {
                processExcel(file, scores);
            } else {
                alert('Please upload a valid Excel file and enter scores for 20 overs.');
            }
        });
    </script>
</body>
</html>
